<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Five in a Row Online</title>
    <link rel="stylesheet" href="../css/FIAR.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
</head>

<body id="body">

<div class="container-fluid mainPart">
    <div class="col-md-3">

    </div>
    <div class="col-md-6" id="board">
    </div>
    <div class="col-md-3">

    </div>
</div>

<script>
    let boardsize = 18;
    let gameStatus = "isRunning";

    let gameCode = Werteliste(location.search)["gamecode"];

    while (gameStatus === "isRunning") {
        console.log("n√§chster GET")
           $.ajax({
               url: 'https://tranquil-ravine-52782-34bf80f0f653.herokuapp.com/api/game/entries?gamecode='+gameCode,
               type: 'get',
               dataType: 'json',
               contentType: 'application/json',
               success: function (data) {

                   let DS = "<table class='tableBoard'>";
                    for (let i = 0; i < data.Board.Size; i++) {
                        DS += "<tr class='tableMarginPadding'>";
                        for (let j = 0; j < data.Board.Size; j++){
                            DS +=   "<td class='tableMarginPadding'>" +
                                        "<img src='../../ressources/Gobang/background.png' class='field' id='"+i+"_"+j+"' alt='' onclick='checkStatus("+i+","+j+")'>"+
                                    "</td>";
                        }
                        DS += "</tr>";
                    }
                    DS += "</table>";

                    $("#board").html(DS);

                   data.Board.Tiles.forEach(function (entry) {
                       if(entry.Status === "playerOne"){
                       $("#" + entry["x-coordinate"] + "_"+ entry["y-coordinate"]).html(
                           checkStatus(entry["x-coordinate"],entry["y-coordinate"])
                       )}
                       else if (entry.Status === "playerTwo"){
                           $("#" + entry["x-coordinate"] + "_"+ entry["y-coordinate"]).html(
                               checkStatus(entry["x-coordinate"],entry["y-coordinate"])
                           )
                       }
                   })
               },
               data: JSON.stringify(game),
               processData: false,
               contentType: "application/json; charset=UTF-8",
               error: function (xhr, ajaxOptions, thrownError) {
                   alert('Error: ' + xhr.status + '   ' + thrownError);
               }
           });
        sleep(2000);
       };


   /* let DS = "<table class='tableBoard'>";
    for (let i = 0; i < 15; i++) {
        DS += "<tr class='tableMarginPadding'>";
        for (let j = 0; j < 15; j++){
            DS +=   "<td class='tableMarginPadding'>" +
                "<img src='../../ressources/Gobang/background.png' class='field' id='"+i+"_"+j+"' alt='' onclick='checkStatus("+i+","+j+")'>"+
                "</td>";
        }
        DS += "</tr>";
    }
    DS += "</table>";

    $("#board").html(DS);

*/

    function checkStatus(i,j) {
        console.log("it works")
        $("#"+i+"_"+j).attr("src","../../ressources/Gobang/whitePiece.png");
    }

    function Werteliste (querystring) {
        console.log(querystring);
        if (querystring == '') return;
        var wertestring = querystring.slice(1);
        var paare = wertestring.split("&");
        var paar, name, wert;
        for (var i = 0; i < paare.length; i++) {
            paar = paare[i].split("=");
            name = paar[0];
            wert = paar[1];
            name = unescape(name).replace("+", " ");
            wert = unescape(wert).replace("+", " ");
            this[name] = wert;
        }
    }
</script>



</body>
</html>
